# フォールバックハンドラーを設定する

この宝箱を開くため、SMSアプリケーションが使用できなくなるエラーの処理方法を設定します。アプリケーションがダウンしている場合は、アプリケーションで問題が発生している(もちろん、対処中であることもです!)ことを穏やかに知らせるバックアップメッセージを用意することをお勧めします。

ベストプラクティスを検証し、コールバックの設定方法を紹介した後、ホストされたTwiML Binから[Message動詞](https://www.twilio.com/docs/sms/twiml/message)を使用する方法を確認します。

## フォールバックとは?

開発者にとってのベストプラクティスとは、エラーを予測するだけでなくそれに備えることでもあります。これは通常、「フォールバック」と呼ばれるある種のメカニズムを介して行われます。ほとんどのプログラミング言語には、`try`/`catch`のようなある種のキーワードがあります。このロジックは、コードを試し(try)、それが機能しない場合にはエラーをキャッチ(catch)し、処理するというものです。エラー処理ケースにフォールバックします。

Twilioでは、この機能を着信メッセージ用に提供しています。

## 残念ながらエラーは起こり得るもの

実生活と同じように、間違いは起こります。不正な形式のTwiMLなど、これらの間違いの一部は、アプリケーションをダウンさせる可能性があります。Twilioがアプリケーションに問い合わせ、何らかのTwiML命令を想定している場合、コードから「湧き出た」エラーを処理する方法が分かりません。

なぜ他にバックアッププランが必要なのでしょうか?ネットワークが遅く、サーバーがタイムリーに応答できない可能性があります。メッセージを送信する人をいつまでも待たせたくありません!

## なるほど、納得です。フォールバックを作成する方法を教えてください。

電話番号の編集画面にある[**Messaging**]セクションの下に(前のバリアで設定した[A message comes in]ハンドラーの下に)、`Primary Handler Fails`というフィールドがあります。

- ドロップダウンメニューで、[TwiML]を選択します
- 表示される`+`(プラス)ボタンをクリックし、新しいTwiML Binを作成します
- 例えば、「Backup Message bin」のような分かりやすい名前を付けます。
- TwiML命令を追加し、バックアップメッセージを送信します

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Response>
    <Message>We're sorry. We are currently experience difficulties. Please try again later. 🍰 </Message>
</Response>
```

(もちろん、和ませる目的の絵文字🍰はオプションです。)

`Valid Messaging TwiML`の確認が表示されたら、[**Create**]をクリックして新しいバックアップTwiML Binを保存します。

最後に、電話番号の編集画面で[**Save**]ボタンを押し、変更を保存してください。

## エラーを意図的に発生させる

バックアップハンドラーが機能していることを確認する場合は、着信メッセージを処理するTwiML Binを意図的に破壊する必要があります。この破壊により、Twilioは[Primary Handler Fails]で設定したTwiML Binを確認します。プライマリTwiML命令を無効にする簡単な方法は、「OnIncomingResponse」TwiMLの`<Response>`タグをすべて小文字`<response>`にすることです。その変更を一時的に**保存**してから、SMSを電話番号に送信します。

返信としてバックアップメッセージを受け取りましたか?エラーメッセージの表示を確認できて嬉しい瞬間ですね。

では、フィールドに番号を入力し、[**HACK**]ボタンを押して入念な準備の結果を確認します。

(後で忘れずにプライマリTwiML Binを**修正**してください。バックアッププランも大切ですが、ただのバックアップに過ぎません。)